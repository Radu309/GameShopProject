@model ShoppingService.Models.Dto.ChatDto

@section Scripts {
    <script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/5.0.15/signalr.min.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const connection = new signalR.HubConnectionBuilder()
                .withUrl("/chatHub")
                .withAutomaticReconnect()
                .build();

            connection.start()
                .then(() => {
                    console.log("Connected to SignalR");

                    connection.on("ReceiveMessage", (user, message) => {
                        const messageList = document.getElementById("messageList");
                        const newMessage = document.createElement("li");
                        newMessage.innerHTML = `<strong>${user}:</strong> ${message}`;
                        messageList.appendChild(newMessage);
                    });
                })
                .catch(err => console.error("Connection error: ", err));

            document.getElementById("sendButton").addEventListener("click", async () => {
                const user = document.getElementById("userInput").value;
                const message = document.getElementById("messageInput").value;

                if (user && message) {
                    await connection.invoke("SendMessage", user, message);
                    document.getElementById("messageInput").value = ""; // Clear input
                }
            });
        });
    </script>
}

<div class="chat-container">
    <h1>Chat Room</h1>

    <div class="message-list">
        <p>No messages yet. Start chatting!</p>
        <ul id="messageList" style="list-style: none; margin: 0; padding: 0;"></ul>
    </div>

    <div class="input-container">
        <div class="input-field">
            <label class="input-label">User:</label>
            <input id="userInput" type="text" class="input-box" placeholder="Enter your name" />
        </div>
        <div class="input-field">
            <label class="input-label">Message:</label>
            <input id="messageInput" type="text" class="input-box" placeholder="Type your message" />
        </div>
        <button id="sendButton" class="send-button">Send</button>
    </div>
</div>

<style>
    .chat-container { max-width: 600px; margin: 0 auto; padding: 20px; border: 1px solid #ddd; border-radius: 5px; }
    .message-list { margin-bottom: 20px; }
    .input-container { display: flex; flex-direction: column; gap: 10px; }
    .input-field { display: flex; flex-direction: column; }
    .input-box { padding: 8px; border: 1px solid #ddd; border-radius: 4px; }
    .send-button { padding: 10px; background-color: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
    .send-button:hover { background-color: #0056b3; }
</style>
